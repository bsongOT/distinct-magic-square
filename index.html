<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <script src="korean.js"></script>
    <script>
        const kwords_4 = (
            kwords
                .filter(wi => !wi["-가"].startsWith("-"))
                .map(wi => wi["-가"].replaceAll("-", "").replaceAll("^", "").replaceAll(" ", ""))
                .filter(w => w.length === 4)
        );
        const kwords_2 = (
            kwords
                .filter(wi => !wi["-가"].startsWith("-"))
                .map(wi => wi["-가"].replaceAll("-", "").replaceAll("^", "").replaceAll(" ", ""))
                .filter(w => w.length === 2)
                .filter(w => w[0] !== w[1])
        )
        const kwords_no_redundancy_4 = [...new Set(
            kwords_4.filter(w => 
                w[0] !== w[1] && w[0] !== w[2] && w[0] !== w[3] &&
                w[1] !== w[2] && w[1] !== w[3] && w[2] !== w[3]
            )
            .filter(w => w.split("")
                .every(ws => 
                    ws.charCodeAt(0) >= '가'.charCodeAt(0) && 
                    ws.charCodeAt(0) <= '힣'.charCodeAt(0)
                )
            )
        )];
        let magicSquare = new Array(16).fill("");
        let dict = {};
        let count = 0;
        for (let word of kwords_no_redundancy_4){
            const word0to1 = word[0] + word[1];
            const word0to2 = word0to1 + word[2];
            if (!dict[word[0]]){
                dict[word[0]] = kwords_no_redundancy_4.filter(w => w.startsWith(word[0]))
            }
            if (!dict[word0to1]){
                dict[word0to1] = kwords_no_redundancy_4.filter(w => w.startsWith(word0to1))
            }
            if (!dict[word0to2]){
                dict[word0to2] = kwords_no_redundancy_4.filter(w => w.startsWith(word0to2))
            }
            dict[word] = [word];
        }
        
        for (let i = 0; i < kwords_no_redundancy_4.length; i++){
            if (i % 100 === 0) console.log(`${i}/${kwords_no_redundancy_4.length}`);
            magicSquare = new Array(16).fill("");
            magicSquare[0] = kwords_no_redundancy_4[i][0];
            magicSquare[1] = kwords_no_redundancy_4[i][1];
            magicSquare[2] = kwords_no_redundancy_4[i][2];
            magicSquare[3] = kwords_no_redundancy_4[i][3];
            
            for (const col1 of dict[magicSquare[0]]){
                magicSquare = magicSquare.map((v, i) => i <= 3 ? v : "");

                if (magicSquare.includes(col1[1])) continue;
                if (magicSquare.includes(col1[2])) continue;
                if (magicSquare.includes(col1[3])) continue;
                if (!dict[magicSquare[1]]) continue;
                if (!dict[magicSquare[2]]) continue;
                if (!dict[magicSquare[3]]) continue;

                magicSquare[4] = col1[1];
                magicSquare[8] = col1[2];
                magicSquare[12] = col1[3];
                for (const col2 of dict[magicSquare[1]]){
                    magicSquare = magicSquare.map((v, i) => (i <= 3 || i % 4 === 0) ? v : "");

                    if (magicSquare.includes(col2[1])) continue;
                    if (magicSquare.includes(col2[2])) continue;
                    if (magicSquare.includes(col2[3])) continue;
                    if (!dict[col1[1] + col2[1]]) continue;
                    if (!dict[col1[2] + col2[2]]) continue;
                    if (!dict[col1[3] + col2[3]]) continue;
                    magicSquare[5] = col2[1];
                    magicSquare[9] = col2[2];
                    magicSquare[13] = col2[3];
                    for (const row2 of dict[magicSquare[4] + magicSquare[5]]){
                        magicSquare = magicSquare.map((v, i) => (i <= 3 || i % 4 <= 1) ? v : "");

                        if (magicSquare.includes(row2[2])) continue;
                        if (magicSquare.includes(row2[3])) continue;
                        if (!dict[magicSquare[2] + row2[2]]) continue;
                        if (!dict[magicSquare[3] + row2[3]]) continue;

                        magicSquare[6] = row2[2];
                        magicSquare[7] = row2[3];
                        
                        for (const col3 of dict[magicSquare[2] + magicSquare[6]]){
                            magicSquare = magicSquare.map((v, i) => (i <= 7 || i % 4 <= 1) ? v : "");

                            if (magicSquare.includes(col3[2])) continue;
                            if (magicSquare.includes(col3[3])) continue;
                            if (!dict[col1[2] + col2[2] + col3[2]]) continue;
                            if (!dict[col1[3] + col2[3] + col3[3]]) continue;
                            
                            magicSquare[10] = col3[2];
                            magicSquare[14] = col3[3];

                            for (const row3 of dict[magicSquare[8] + magicSquare[9] + magicSquare[10]]){
                                magicSquare[11] = "";
                                magicSquare[15] = "";
                                if (magicSquare.includes(row3[3])) continue;
                                if (dict[magicSquare[3] + magicSquare[7] + row3[3]] === undefined) continue;
                                
                                magicSquare[11] = row3[3];
                                
                                for (const row4 of dict[magicSquare[12] + magicSquare[13] + magicSquare[14]]){
                                    magicSquare[15] = "";
                                    if (magicSquare.includes(row4[3])) continue;
                                    if (dict[magicSquare[3] + magicSquare[7] + magicSquare[11] + row4[3]] === undefined) continue;
                                    magicSquare[15] = row4[3];
                                    console.log(
                                        magicSquare.slice(0, 4).join("") + "\n" + 
                                        magicSquare.slice(4, 8).join("") + "\n" + 
                                        magicSquare.slice(8, 12).join("") + "\n" + 
                                        magicSquare.slice(12).join("")
                                    );
                                }
                            }
                        }
                    }
                }
            }
        }
    </script>
</body>
</html>